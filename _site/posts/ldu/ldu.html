<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Sánchez">
<meta name="dcterms.date" content="2023-10-25">
<meta name="description" content="Liga Deportiva Universitaria demuestra una vez más su potencial internacional pasando a la final de la Copa Sudamericana 2023. En este post, reviso la trayectoria de LDU en campeonatos internacionales CONMEBOL, extrayendo datos de diferentes fuentes con R. Imagen generada con inteligencia artificial.">

<title>Daniel - El trono en Ponceano: Liga de Quito en cifras con R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../icon.jpeg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Daniel - El trono en Ponceano: Liga de Quito en cifras con R">
<meta property="og:description" content="Liga Deportiva Universitaria demuestra una vez más su potencial internacional pasando a la final de la Copa Sudamericana 2023. En este post, reviso la trayectoria de LDU en campeonatos internacionales CONMEBOL, extrayendo datos de diferentes fuentes con R. Imagen generada con inteligencia artificial.">
<meta property="og:image" content="https://daniel-ec.netlify.app/posts/ldu/dalle.png">
<meta property="og:site-name" content="Daniel">
<meta property="og:image:height" content="1024">
<meta property="og:image:width" content="1024">
<meta name="twitter:title" content="Daniel - El trono en Ponceano: Liga de Quito en cifras con R">
<meta name="twitter:description" content="Liga Deportiva Universitaria demuestra una vez más su potencial internacional pasando a la final de la Copa Sudamericana 2023. En este post, reviso la trayectoria de LDU en campeonatos internacionales CONMEBOL, extrayendo datos de diferentes fuentes con R. Imagen generada con inteligencia artificial.">
<meta name="twitter:image" content="https://daniel-ec.netlify.app/posts/ldu/icon.jpeg">
<meta name="twitter:creator" content="@daniel_ec18">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Daniel Sánchez</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../research.html" rel="" target="">
 <span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html" rel="" target="">
 <span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources.html" rel="" target="">
 <span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../media.html" rel="" target="">
 <span class="menu-text">Media</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts_home.html" rel="" target="">
 <span class="menu-text">Posts</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">El trono en Ponceano: Liga de Quito en cifras con R</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Liga Deportiva Universitaria demuestra una vez más su potencial internacional pasando a la final de la Copa Sudamericana 2023. En este post, reviso la trayectoria de LDU en campeonatos internacionales CONMEBOL, extrayendo datos de diferentes fuentes con R. Imagen generada con inteligencia artificial.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">spanish</div>
                <div class="quarto-category">ecuador</div>
                <div class="quarto-category">football</div>
                <div class="quarto-category">data viz</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Sánchez </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">October 25, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preliminares</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar librerias</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(worldfootballR)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir tema base</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add_google</span>(<span class="st">"Questrial"</span>, <span class="at">family =</span> <span class="st">"Questrial"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>theme_daniel<span class="ot">&lt;-</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_hc</span>(<span class="at">style =</span> <span class="st">'darkunica'</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_family =</span> <span class="st">'Questrial'</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_size =</span> <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'white'</span>),</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">'italic'</span>),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">'plot'</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption.position =</span> <span class="st">'plot'</span>,</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">lineheight =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">60</span>),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'gray'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Después de casi 14 años desde su última final en un campeonato internacional, Liga Deportiva Universitaria de Quito (LDU) selló su pase a la final de la Copa Sudamericana (el segundo campeonato más importante del fútbol de clubes en Sudamérica) derrotando al Defensa y Justicia argentino por goleada. El triunfo de Liga no viene fácil: aunque se ganó el apodo de <em>Rey de Copas</em> por los cuatro títulos internacionales ganados durante 2007-2010 (incluyendo la Copa Libertadores, el título más importante de América, nunca antes ganado por otro equipo ecuatoriano), al equipo le ha costado restaurar su gloria desde entonces.</p>
<p>El 28 de Octubre del 2023 Liga promete desempolvar el trono en Ponceano enfrentandose en Montevideo, Uruguay ante Fortaleza, equipo recientemente ascendido a la Serie A Brasileirao. En homenaje al equipo y en la misma línea de los otros artículos de este blog, en este post reviso la trayectoria de Liga en campeonatos internacionales de fútbol, aprovechando la oportunidad para explorar las posibilidades de extracción de datos de fútbol con R.</p>
<div class="cell" data-hash="ldu_cache/html/extraccion-datos_ff44f870070a9248c4d43eb05a7a5595">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop para extraer informacion-copa-sudamericana</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>libertadores_matches_raw <span class="ot">&lt;-</span> <span class="fu">load_match_comp_results</span>(<span class="st">'Copa Libertadores de América'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>sudamericana_matches_raw <span class="ot">&lt;-</span> <span class="fu">load_match_comp_results</span>(<span class="st">'Copa Sudamericana'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos de Copa Libertadores</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>libertadores_matches <span class="ot">&lt;-</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  libertadores_matches_raw  <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">competition_name =</span> <span class="fu">iconv</span>(competition_name, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"latin1"</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">year =</span> season_end_year,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">round_number =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'First stage'</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Second stage'</span>, <span class="st">'Group stage'</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Knockout round play-offs'</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Round of 16'</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Quarter-finals'</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Semi-finals'</span> <span class="sc">~</span> <span class="dv">9</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Final'</span>, <span class="st">'Finals'</span>) <span class="sc">~</span> <span class="dv">11</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            day,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            time,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_country =</span> <span class="fu">str_sub</span>(home, <span class="at">start =</span> <span class="sc">-</span><span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_name =</span> <span class="fu">str_sub</span>(home, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            home_goals,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_country =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_name =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">4</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>            away_goals,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">result =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> <span class="st">'home_win'</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> <span class="st">'away_win'</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">match_winner =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> home_team_name,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> away_team_name,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="st">'none-draw'</span>),</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">leg =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 1%'</span>) <span class="sc">~</span> <span class="st">'leg_1'</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 2%'</span>) <span class="sc">~</span> <span class="st">'leg_2'</span>,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">penalty_kicks =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%penalties%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">extra_time =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%extra time%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            venue,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>            attendance,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            referee,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>            notes)</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos de Copa Sudamericana</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>sudamericana_matches <span class="ot">&lt;-</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches_raw  <span class="sc">%&gt;%</span> </span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(competition_name,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>            <span class="at">year =</span> season_end_year,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>            <span class="at">round_number =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'First stage'</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Second stage'</span>, <span class="st">'Group stage'</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Knockout round play-offs'</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Round of 16'</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Quarter-finals'</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Semi-finals'</span> <span class="sc">~</span> <span class="dv">9</span>,</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Final'</span>, <span class="st">'Finals'</span>) <span class="sc">~</span> <span class="dv">11</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>            day,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>            time,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_country =</span> <span class="fu">str_sub</span>(home, <span class="at">start =</span> <span class="sc">-</span><span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_name =</span> <span class="fu">str_sub</span>(home, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>),</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            home_goals,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_country =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_name =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">4</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>            away_goals,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">result =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> <span class="st">'home_win'</span>,</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> <span class="st">'away_win'</span>,</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>            <span class="at">match_winner =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> home_team_name,</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> away_team_name,</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="st">'none-draw'</span>),</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>            <span class="at">leg =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 1%'</span>) <span class="sc">~</span> <span class="st">'leg_1'</span>,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 2%'</span>) <span class="sc">~</span> <span class="st">'leg_2'</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">penalty_kicks =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%penalties%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>            <span class="at">extra_time =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%extra time%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>            venue,</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>            attendance,</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>            referee,</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>            notes)</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar para datos de LDU en Copa Libertadores solamente</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>libertadores_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>  libertadores_matches  <span class="sc">%&gt;%</span> </span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>)</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener la ultima etapa alcanzada para cada año de LDU</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>ldu_stage_reached_libertadores <span class="ot">&lt;-</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  libertadores_matches_ldu  <span class="sc">%&gt;%</span> </span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)  <span class="sc">%&gt;%</span> </span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">stage_reached_libertadores =</span> <span class="fu">max</span>(round_number, <span class="at">na.rm =</span> T))</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar para datos de LDU en Copa Sudamericana solamente</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>sudamericana_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches  <span class="sc">%&gt;%</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener la ultima etapa alcanzada para cada año de LDU</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>ldu_stage_reached_sudamericana <span class="ot">&lt;-</span></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches_ldu  <span class="sc">%&gt;%</span> </span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)  <span class="sc">%&gt;%</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">stage_reached_sudamericana =</span> <span class="fu">max</span>(round_number, <span class="at">na.rm =</span> T))</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear data frame para realizar grafico de resultados LDU en campeonatos internacionales </span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>international_results_ldu <span class="ot">&lt;-</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>  ldu_stage_reached_libertadores  <span class="sc">%&gt;%</span></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">stage_reached_libertadores =</span> <span class="fl">0.1</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tournament =</span> <span class="st">'Libertadores'</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">stage_reached =</span> stage_reached_libertadores) <span class="sc">%&gt;%</span> </span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    ldu_stage_reached_sudamericana  <span class="sc">%&gt;%</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">stage_reached_sudamericana =</span> <span class="fl">0.1</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">tournament =</span> <span class="st">'Sudamericana'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">stage_reached =</span> stage_reached_sudamericana)</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">''</span>,</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">~</span> <span class="st">'Grupos'</span>,</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">'Repechaje'</span>,</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">'Octavos de final'</span>,</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">'Cuartos de final'</span>,</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">'Semifinal'</span>,</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">'Final'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Existen varias referencias que describen la implementación de métodos de <em>football analytics</em>, sin embargo el problema aparece cuando se quiere implementar los métodos para el Ecuador. De forma decepcionante (aunque quizás no sorprendente), <strong>no existe una autoridad que provea datos oficiales de la LigaPro Ecuador</strong>. Existen algunas páginas web que proveen datos básicos, con especial atención al esfuerzo de <a href="https://twitter.com/mifutbolecuador">@mifutbolecuador</a>, sin embargo, no es posible encontrar una fuente que permita descargas. Curiosamente, sucede lo mismo para los campeonatos internacionales CONMEBOL: aunque existe más información disponible, es complicado llegar a una base de datos limpia y descargable. Esto quizás se debe al potencial uso monetario de estos datos dada la existencia de la industria de las apuestas deportivas (especialmente importante en Ecuador).</p>
<p>Ventajosamente, existen esfuerzos internacionales que recientemente han empezado a recopilar información sobre equipos ecuatorianos. Uno es <a href="https://fbref.com/en/about/">FBref.com</a>, un sitio web que provee datos de fútbol de todo el mundo. Otro sitio web similar es <a href="https://www.transfermarkt.com/">Transfermarkt</a>. La información de ambos sitios web es de libre acceso, aunque no es posible descargar los datos directamente desde la página web. Sin embargo, su existencia que permiten una técnica común de recolección de datos: <em>web scraping</em>. El scraping puede ser un problema por varias razones, ya que requiere entender las estructuras de datos de la página web para construir un códgio de scraping robusto. Ventajosamente, R ofrece un atajo <em>excelente</em>: la librería <em>worldfootballR</em> de <a href="https://twitter.com/JaseZiv">@JaseZiv</a>, que permite hacer scraping de forma fácil automática. Arriba utilicé esta librería para acceder a datos pre-procesados de FBref para todos los partidos de Copa Libertadores<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> y Sudamericana<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> desde 2014 hasta 2023<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de resultados LDU en campeonatos internacionales</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Libertadores'</span><span class="ot">=</span> <span class="st">'#C7B143'</span>, <span class="st">'Sudamericana'</span> <span class="ot">=</span> <span class="st">'#20409A'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>international_results_ldu  <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">2014</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, stage_reached, <span class="at">fill =</span> tournament)) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.8</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2015.2</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2015.8</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">'Grupos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2017.2</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2018.2</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2018.8</span>, <span class="at">y =</span> <span class="dv">6</span>, <span class="at">label =</span> <span class="st">'Cuartos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2019.8</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2020.8</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">'Grupos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2021.2</span>, <span class="at">y =</span> <span class="dv">6</span>, <span class="at">label =</span> <span class="st">'Cuartos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2022.2</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">'Grupos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2023.2</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">label =</span> <span class="st">'Final'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">''</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">''</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'Resultados de copas internacionales para Liga de Quito'</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Copa Libertadores y Copa Sudamericana, 2015-2023'</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">'Campeonato'</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">'Nota: Valores sin etiqueta se presentan cuando LDU no participó en el campeonato.'</span>)<span class="sc">+</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  theme_daniel<span class="sc">+</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.08</span>, <span class="fl">0.88</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ldu_files/figure-html/grafico-resultados-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>Naturalmente, a Liga le ha costado mas terminar en etapas avanzadas de Copa Libertadores que de Copa Sudamericana. El salto a la final de la COpa Sudamericana se da de forma abrupta: en 2022 no logra pasar de la etapa de grupos, pero en 2023 arrasa y llega a la final en Montevideo para enfrentarse a Fortaleza de Brasil, un equipo relativamente nuevo en la escena internacional al haber recientemente ascendido a la primera división de Brasil.</p>
<p>Una de las complicaciones de los datos (tanto en FBref como en Transfermarkt) es que el gráfico arriba solamente muestra una escena parcial de la historia de LDU en campeonatos internacionales. Lo más lejos que se puede observar es el resultado de Sudamericana en 2015, en donde Liga cayó ante River Plate tras un recordado <a href="https://www.youtube.com/watch?v=kXfFJ-mEBjk">penal errado</a> por Jonathan Álvez, con Liga como anfitrión. No es posible observar los datos de la mítica liga de los 2000, que ganó la Copa Libertadores y Sudamericana en 2008 y 2009 además de dos Recopas<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> en 2009 y 2010. Tampoco es posible observar el periodo posterior a 2010, en donde Liga de Quito no logró clasificar a ningún torneo internacional hasta 2015.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer datos de partidos de Sudamericana para obtener Top Rivales de Liga en Sudamericana</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sudamericana_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(year,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_home_or_away =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Home'</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>              away_team_name<span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Away'</span>),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_name,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_name),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_country =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_country,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_country),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals),</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_result =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&gt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Win'</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&lt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Loss'</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">==</span> opponent_goals <span class="sc">~</span> <span class="st">'Draw'</span>),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">tournament =</span> <span class="st">'Sudamericana'</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacer lo mismo para Libertadores</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>libertadores_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  libertadores_matches <span class="sc">%&gt;%</span> </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(year,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_home_or_away =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Home'</span>,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>              away_team_name<span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Away'</span>),</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_name,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_name),</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_country =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_country,</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_country),</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals),</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals),</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_result =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&gt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Win'</span>,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&lt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Loss'</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">==</span> opponent_goals <span class="sc">~</span> <span class="st">'Draw'</span>),</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>            <span class="at">tournament =</span> <span class="st">'Libertadores'</span>)</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Unir dataframes y obtener totales de goles a favor y en contra para cada año y por cada torneo</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>ldu_match_goals <span class="ot">&lt;-</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(sudamericana_matches_ldu, libertadores_matches_ldu) <span class="sc">%&gt;%</span> </span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, tournament) <span class="sc">%&gt;%</span> </span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ldu_goals =</span> <span class="fu">sum</span>(ldu_goals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_goals =</span> <span class="fu">sum</span>(opponent_goals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_wins =</span> <span class="fu">sum</span>(ldu_result <span class="sc">==</span> <span class="st">'Win'</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_losses =</span> <span class="fu">sum</span>(ldu_result <span class="sc">==</span> <span class="st">'Loss'</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_draws =</span> <span class="fu">sum</span>(ldu_result <span class="sc">==</span> <span class="st">'Draw'</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_matches =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ldu_goal_difference =</span> ldu_goals <span class="sc">-</span> opponent_goals,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">ldu_win_percentage =</span> ldu_wins <span class="sc">/</span> total_matches <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, tournament) <span class="sc">%&gt;%</span> </span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar </span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>ldu_match_goals <span class="sc">%&gt;%</span> </span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tournament, ldu_goals, opponent_goals) <span class="sc">%&gt;%</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(ldu_goals, opponent_goals),</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">'goals_from'</span>,</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">'goals'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">goals_from =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    goals_from <span class="sc">==</span> <span class="st">'ldu_goals'</span> <span class="sc">~</span> <span class="st">'A favor'</span>,</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    goals_from <span class="sc">==</span> <span class="st">'opponent_goals'</span> <span class="sc">~</span> <span class="st">'En contra'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> goals, <span class="at">fill =</span> goals_from)) <span class="sc">+</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">'dodge'</span>) <span class="sc">+</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2015</span>, <span class="dv">2023</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'#20409A'</span>, <span class="st">'#EE2E24'</span>)) <span class="sc">+</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>tournament) <span class="sc">+</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Goles a favor y en contra de LDU'</span>,</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Torneos internacionales 2015-2023'</span>,</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">''</span>,</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Goles'</span>,</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">''</span>,</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">str_wrap</span>(<span class="st">'Nota: se presentan goles a favor y en contra solo en casos en donde LDU clasificó y participó en al menos en un partido. Datos de FBref.'</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>  theme_daniel <span class="sc">+</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">'white'</span>),</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">linewidth=</span><span class="dv">4</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'white'</span>),</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>,<span class="fl">1.18</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ldu_files/figure-html/datos-partidos-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>Los datos preprocesados de <em>worldfootballR</em> permiten calcular el número de goles a favor y en contra para cada una de las temporadas de LDU en torneos internacionales. Naturalmente, el equipo ha mejorado su ratio de goles a medida que ha ido pasando a etapas más avanzadas del torneo y como es de esperarse, Liga es más capaz de mantener su arco en cero en la Sudamericana que en la Libertadores. El mejor desempeño de LDU en la Sudamericana se da este año, con 23 goles en 14 partidos, lo que representa un 50% de partidos ganados. Esto, sin embargo, no es el mejor record de LDU en torneos internacionales de los últimos años: en 2020, aunque el equipo solo pasó a octavos de final, logró un 62.5% de partidos ganados en Copa Libertadores. Esto es un claro ejemplo de cómo la estadística simple no debería ser malinterpretada en contextos deportivos como éste.</p>
<p>Sin embargo, hay indicadores que rara vez fallan, y uno de ellos es $ <em>la plata</em> $. ¿Cuánto invirtió Liga de Quito en los últimos años para llegar donde está el día de hoy? Esta pregunta podría parecer extremadamente complicada de responder, pero los datos de Transfermarkt, plataforma alemana conocida por su exactitud en cuanto a información de traspasos y valor de jugadores, lo facilita. La función que permite obtener esta información permite solamente observar un año a la vez, por lo que utilizo un <code>for</code> <em>loop</em> (<a href="loops.jpg">aunque muy temidos en R, los loops son manejables</a>) para obtener la información de los últimos años sin tener que llamar la función una y otra vez.</p>
<div class="cell" data-hash="ldu_cache/html/ldu-finances_fe090d9e9cffe64c06251835cfa1e1f9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># El campeonato ecuatoriano está distribuido en dos diferentes links de Transfermarkt, es necesario crear un foroop para cada uno: </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector de años para el loop (2019-2022)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>years_1 <span class="ot">&lt;-</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicializar una lista para guardar los resultados de cada iteracion del loop</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>ecuador_finances1 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> years_1){</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  ecuador_finances1[[<span class="fu">which</span>(years_1 <span class="sc">==</span> i)]] <span class="ot">&lt;-</span> <span class="fu">tm_team_transfer_balances</span>(<span class="st">'ECU'</span>, </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                                                     i, </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                                                                     <span class="at">league_url =</span> <span class="st">'https://www.transfermarkt.com/ligapro-serie-a-primera-etapa/startseite/wettbewerb/EL1A'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> i) <span class="co"># Agregar año para cada iteracion</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># El siguiente loop requiere tanto el link como el año, definir los vectores a continuacion</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Siguiente link: 2012-2018</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>years_2 <span class="ot">&lt;-</span> <span class="dv">2012</span><span class="sc">:</span><span class="dv">2018</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2011'</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2012'</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2013'</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2014'</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2015'</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2016'</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2017'</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2018'</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>ecuador_finances2 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years_2)){</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a> ecuador_finances2[[years_2[i]]] <span class="ot">&lt;-</span> <span class="fu">tm_team_transfer_balances</span>(<span class="st">'ECU'</span>, years_2[i], <span class="at">league_url =</span> links[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">mutate</span>(<span class="at">year =</span> years_2[i]) </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer informacion a un dataframe y limpiar datos:</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>ecuador_finances_full <span class="ot">&lt;-</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(ecuador_finances1, ecuador_finances2) </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar para solo LDU, calcular ingresos-egresos y graficar en un grafico de barras</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>ecuador_finances_full <span class="sc">%&gt;%</span> </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(squad <span class="sc">==</span> <span class="st">'LDU Quito'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(year, </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">income =</span> income_euros, </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">expenditure =</span> <span class="sc">-</span>expenditure_euros) <span class="sc">%&gt;%</span> </span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(income, expenditure),</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">'balance_type'</span>,</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">'values'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">balance_type =</span> <span class="fu">if_else</span>(balance_type <span class="sc">==</span> <span class="st">'income'</span>, <span class="st">'Ingresos'</span>, <span class="st">'Egresos'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">as.factor</span>(year), values<span class="sc">/</span><span class="dv">1000000</span>, <span class="at">fill =</span> balance_type, <span class="at">group =</span> balance_type)) <span class="sc">+</span> </span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">'dodge'</span>)<span class="sc">+</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'Ingresos'</span> <span class="ot">=</span> <span class="st">'#20409A'</span>, <span class="st">'Egresos'</span> <span class="ot">=</span> <span class="st">'#EE2E24'</span>)) <span class="sc">+</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'gray40'</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Ingresos y egresos para Liga de Quito'</span>,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Cifras de traspasos 2012-2022'</span>,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">''</span>,</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Miles de euros'</span>,</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">''</span>,</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">str_wrap</span>(<span class="st">'Nota: 2023 es un año parcial. No se presentan datos para las temporadas donde no se registran jugadores vendidos. Datos de Transfemarkt.'</span>, <span class="dv">115</span>)) <span class="sc">+</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  theme_daniel <span class="sc">+</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">'white'</span>),</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">linewidth=</span><span class="dv">4</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'white'</span>),</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.85</span>,<span class="fl">1.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ldu_files/figure-html/ldu-finances-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p>En 2022 LDU tuvo la mejor temporada en términos de ingresos por traspasos de su historia, logrando vender jugadores por 7.1 millones de euros<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. De forma notable, el club vendió a dos jugadores por altos valores: Rodrigo Aguirre y Nilson Angulo, por 4.75 y 1.90 millones de euros. En 2022 LDU no invirtió dinero en su plantilla, sin embargo, logró traer al equipo a varios agentes libres, situación que no se refleja en el gráfico anterior, pero se puede visualizar en la página web de Transfermarkt. Uno de los jugadores más importantes que llega a LDU como agente libre es Alexander Domínguez, histórico arquero de la selección ecuatoriana y LDU, que regresa al equipo luego de varios años en el exterior. Adicionalmente, las cifras no muestran los valores de contratos temporales, como es el de Renato Ibarra, mediocampista ecuatoriano, quien llega a LDU tras una larga carrera en el fútbol internacional. De todas formas, la inversión en la plantilla de 2021 es la tercera más alta de los últimos 20 años, y los ingresos que LDU ha podido recolectar en 2022 y 2023 potencialmente le permitirán seguir invirtiendo en su plantel existente, así como en la infraestructura del club y las juveniles, que son lo que inicialmente hicieron al club lo que es hoy (y lo que ahora diferencia a Independiente del Valle, también muy exitoso equipo ecuatoriano).</p>
<p>Lejos de ser un ejercicio exhaustivo de análisis, lo que este post intenta hacer es dar una mirada aterrizada a las cifras del equipo en los dos torneos más importantes de la región. Es desafortunado que no exista una fuente de datos centralizada que permita analizar el fútbol ecuatoriano y regional más a fondo, sin embargo, las posibilidades que ofrecen los desarrolladores open source de R, como el paquete utilizado aquí, <em>worldfootballR</em>, son una muestra de que es posible hacer análisis de datos de fútbol de forma más accesible y transparente. Espero que este trabajo sea de utilidad para quiénes se interesen en extraer y analizar datos de fútbol latinoamericano en gran escala, y, ante todo, que sea un buen augurio para la quinta estrella del trono en Ponceano.</p>
<blockquote class="blockquote">
<p><em>Liga te pido ponga🥚…</em></p>
</blockquote>


<!-- -->



<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>La Copa Libertadores es el torneo de clubes más importante de Sudamérica, en donde clasifican los primeros equipos de las divisiones de clubes nacionales de cada país. Es análogo a la Champions League en Europa.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>La Copa Sudamericana es el segundo torneo mas importante del fútbol de clubes sudamericano, en donde clasifican clubes en posiciones intermedias de las divisiones nacionales. Es análogo a la Europa League en Europa.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>En este post, cuando me refiero a un año, realmente me refiero a una <em>temporada</em>. Las temporadas para CONMEBOL y<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Minitorneo en donde el campeón Libertadores se enfrenta al de Sudamericana. Análogo a la Super Cup en Europa<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Esta es la moneda nativa de Transfermarkt.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb6" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "El trono en Ponceano: Liga de Quito en cifras con R"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Daniel Sánchez"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-10-25"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Liga Deportiva Universitaria demuestra una vez más su potencial internacional pasando a la final de la Copa Sudamericana 2023. En este post, reviso la trayectoria de LDU en campeonatos internacionales CONMEBOL, extrayendo datos de diferentes fuentes con R. Imagen generada con inteligencia artificial."</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [spanish, ecuador, football, data viz, R]</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="an">csl:</span><span class="co"> ../../econometrics.csl</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> dalle.png</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">    message: false</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">    echo: true</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">    include: true</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Preliminares</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Cargar librerias</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(worldfootballR)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir tema base</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add_google</span>(<span class="st">"Questrial"</span>, <span class="at">family =</span> <span class="st">"Questrial"</span>)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>theme_daniel<span class="ot">&lt;-</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_hc</span>(<span class="at">style =</span> <span class="st">'darkunica'</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_family =</span> <span class="st">'Questrial'</span>,</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">base_size =</span> <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'white'</span>),</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">'italic'</span>),</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">'plot'</span>,</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.caption.position =</span> <span class="st">'plot'</span>,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">lineheight =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">60</span>),</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">'gray'</span>))</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>Después de casi 14 años desde su última final en un campeonato internacional, Liga Deportiva Universitaria de Quito (LDU) selló su pase a la final de la Copa Sudamericana (el segundo campeonato más importante del fútbol de clubes en Sudamérica) derrotando al Defensa y Justicia argentino por goleada. El triunfo de Liga no viene fácil: aunque se ganó el apodo de *Rey de Copas* por los cuatro títulos internacionales ganados durante 2007-2010 (incluyendo la Copa Libertadores, el título más importante de América, nunca antes ganado por otro equipo ecuatoriano), al equipo le ha costado restaurar su gloria desde entonces.</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>El 28 de Octubre del 2023 Liga promete desempolvar el trono en Ponceano enfrentandose en Montevideo, Uruguay ante Fortaleza, equipo recientemente ascendido a la Serie A Brasileirao. En homenaje al equipo y en la misma línea de los otros artículos de este blog, en este post reviso la trayectoria de Liga en campeonatos internacionales de fútbol, aprovechando la oportunidad para explorar las posibilidades de extracción de datos de fútbol con R.</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: extraccion-datos</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop para extraer informacion-copa-sudamericana</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>libertadores_matches_raw <span class="ot">&lt;-</span> <span class="fu">load_match_comp_results</span>(<span class="st">'Copa Libertadores de América'</span>)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>sudamericana_matches_raw <span class="ot">&lt;-</span> <span class="fu">load_match_comp_results</span>(<span class="st">'Copa Sudamericana'</span>)</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos de Copa Libertadores</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>libertadores_matches <span class="ot">&lt;-</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  libertadores_matches_raw  <span class="sc">%&gt;%</span> </span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">competition_name =</span> <span class="fu">iconv</span>(competition_name, <span class="at">from =</span> <span class="st">"UTF-8"</span>, <span class="at">to =</span> <span class="st">"latin1"</span>),</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>            <span class="at">year =</span> season_end_year,</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>            <span class="at">round_number =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'First stage'</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Second stage'</span>, <span class="st">'Group stage'</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Knockout round play-offs'</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Round of 16'</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Quarter-finals'</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Semi-finals'</span> <span class="sc">~</span> <span class="dv">9</span>,</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Final'</span>, <span class="st">'Finals'</span>) <span class="sc">~</span> <span class="dv">11</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>            day,</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>            time,</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_country =</span> <span class="fu">str_sub</span>(home, <span class="at">start =</span> <span class="sc">-</span><span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_name =</span> <span class="fu">str_sub</span>(home, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>),</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>            home_goals,</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_country =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_name =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">4</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>            away_goals,</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>            <span class="at">result =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> <span class="st">'home_win'</span>,</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> <span class="st">'away_win'</span>,</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>            <span class="at">match_winner =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> home_team_name,</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> away_team_name,</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="st">'none-draw'</span>),</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>            <span class="at">leg =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 1%'</span>) <span class="sc">~</span> <span class="st">'leg_1'</span>,</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 2%'</span>) <span class="sc">~</span> <span class="st">'leg_2'</span>,</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>            <span class="at">penalty_kicks =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%penalties%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>            <span class="at">extra_time =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%extra time%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>            venue,</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>            attendance,</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>            referee,</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>            notes)</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar datos de Copa Sudamericana</span></span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>sudamericana_matches <span class="ot">&lt;-</span></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches_raw  <span class="sc">%&gt;%</span> </span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(competition_name,</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>            <span class="at">year =</span> season_end_year,</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>            <span class="at">round_number =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'First stage'</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Second stage'</span>, <span class="st">'Group stage'</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Knockout round play-offs'</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Round of 16'</span> <span class="sc">~</span> <span class="dv">5</span>,</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Quarter-finals'</span> <span class="sc">~</span> <span class="dv">7</span>,</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">==</span> <span class="st">'Semi-finals'</span> <span class="sc">~</span> <span class="dv">9</span>,</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>              round <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Final'</span>, <span class="st">'Finals'</span>) <span class="sc">~</span> <span class="dv">11</span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>            day,</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>            time,</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_country =</span> <span class="fu">str_sub</span>(home, <span class="at">start =</span> <span class="sc">-</span><span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>            <span class="at">home_team_name =</span> <span class="fu">str_sub</span>(home, <span class="at">end =</span> <span class="sc">-</span><span class="dv">4</span>),</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>            home_goals,</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_country =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> <span class="fu">str_to_upper</span>(),</span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>            <span class="at">away_team_name =</span> <span class="fu">str_sub</span>(away, <span class="at">start =</span> <span class="dv">4</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>            away_goals,</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>            <span class="at">result =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> <span class="st">'home_win'</span>,</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> <span class="st">'away_win'</span>,</span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>            <span class="at">match_winner =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&gt;</span> away_goals <span class="sc">~</span> home_team_name,</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">&lt;</span> away_goals <span class="sc">~</span> away_team_name,</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>              home_goals <span class="sc">==</span> away_goals <span class="sc">~</span> <span class="st">'none-draw'</span>),</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>            <span class="at">leg =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 1%'</span>) <span class="sc">~</span> <span class="st">'leg_1'</span>,</span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>              notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%Leg 2%'</span>) <span class="sc">~</span> <span class="st">'leg_2'</span>,</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>              <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>            <span class="at">penalty_kicks =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%penalties%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>            <span class="at">extra_time =</span> <span class="fu">if_else</span>(notes  <span class="sc">%&gt;%</span> <span class="fu">str_like</span>(<span class="st">'%extra time%'</span>), <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>            venue,</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>            attendance,</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>            referee,</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>            notes)</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar para datos de LDU en Copa Libertadores solamente</span></span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>libertadores_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>  libertadores_matches  <span class="sc">%&gt;%</span> </span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>)</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener la ultima etapa alcanzada para cada año de LDU</span></span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>ldu_stage_reached_libertadores <span class="ot">&lt;-</span></span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>  libertadores_matches_ldu  <span class="sc">%&gt;%</span> </span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)  <span class="sc">%&gt;%</span> </span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">stage_reached_libertadores =</span> <span class="fu">max</span>(round_number, <span class="at">na.rm =</span> T))</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar para datos de LDU en Copa Sudamericana solamente</span></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>sudamericana_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches  <span class="sc">%&gt;%</span></span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>)</span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtener la ultima etapa alcanzada para cada año de LDU</span></span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>ldu_stage_reached_sudamericana <span class="ot">&lt;-</span></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches_ldu  <span class="sc">%&gt;%</span> </span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year)  <span class="sc">%&gt;%</span></span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">stage_reached_sudamericana =</span> <span class="fu">max</span>(round_number, <span class="at">na.rm =</span> T))</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear data frame para realizar grafico de resultados LDU en campeonatos internacionales </span></span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>international_results_ldu <span class="ot">&lt;-</span></span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>  ldu_stage_reached_libertadores  <span class="sc">%&gt;%</span></span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">stage_reached_libertadores =</span> <span class="fl">0.1</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tournament =</span> <span class="st">'Libertadores'</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">stage_reached =</span> stage_reached_libertadores) <span class="sc">%&gt;%</span> </span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>    ldu_stage_reached_sudamericana  <span class="sc">%&gt;%</span></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>      <span class="fu">complete</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>      <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">stage_reached_sudamericana =</span> <span class="fl">0.1</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">tournament =</span> <span class="st">'Sudamericana'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">stage_reached =</span> stage_reached_sudamericana)</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>    <span class="at">.default =</span> <span class="st">''</span>,</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">~</span> <span class="st">'Grupos'</span>,</span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">'Repechaje'</span>,</span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">'Octavos de final'</span>,</span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">'Cuartos de final'</span>,</span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">'Semifinal'</span>,</span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>    stage_reached <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">'Final'</span>))</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>Existen varias referencias que describen la implementación de métodos de *football analytics*, sin embargo el problema aparece cuando se quiere implementar los métodos para el Ecuador. De forma decepcionante (aunque quizás no sorprendente), **no existe una autoridad que provea datos oficiales de la LigaPro Ecuador**. Existen algunas páginas web que proveen datos básicos, con especial atención al esfuerzo de <span class="co">[</span><span class="ot">\@mifutbolecuador</span><span class="co">](https://twitter.com/mifutbolecuador)</span>, sin embargo, no es posible encontrar una fuente que permita descargas. Curiosamente, sucede lo mismo para los campeonatos internacionales CONMEBOL: aunque existe más información disponible, es complicado llegar a una base de datos limpia y descargable. Esto quizás se debe al potencial uso monetario de estos datos dada la existencia de la industria de las apuestas deportivas (especialmente importante en Ecuador).</span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>Ventajosamente, existen esfuerzos internacionales que recientemente han empezado a recopilar información sobre equipos ecuatorianos. Uno es <span class="co">[</span><span class="ot">FBref.com</span><span class="co">](https://fbref.com/en/about/)</span>, un sitio web que provee datos de fútbol de todo el mundo. Otro sitio web similar es <span class="co">[</span><span class="ot">Transfermarkt</span><span class="co">](https://www.transfermarkt.com/)</span>. La información de ambos sitios web es de libre acceso, aunque no es posible descargar los datos directamente desde la página web. Sin embargo, su existencia que permiten una técnica común de recolección de datos: *web scraping*. El scraping puede ser un problema por varias razones, ya que requiere entender las estructuras de datos de la página web para construir un códgio de scraping robusto. Ventajosamente, R ofrece un atajo *excelente*: la librería *worldfootballR* de <span class="co">[</span><span class="ot">\@JaseZiv</span><span class="co">](https://twitter.com/JaseZiv)</span>, que permite hacer scraping de forma fácil automática. Arriba utilicé esta librería para acceder a datos pre-procesados de FBref para todos los partidos de Copa Libertadores<span class="ot">[^1]</span> y Sudamericana<span class="ot">[^2]</span> desde 2014 hasta 2023<span class="ot">[^3]</span>.</span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>La Copa Libertadores es el torneo de clubes más importante de Sudamérica, en donde clasifican los primeros equipos de las divisiones de clubes nacionales de cada país. Es análogo a la Champions League en Europa.</span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a><span class="ot">[^2]: </span>La Copa Sudamericana es el segundo torneo mas importante del fútbol de clubes sudamericano, en donde clasifican clubes en posiciones intermedias de las divisiones nacionales. Es análogo a la Europa League en Europa.</span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a><span class="ot">[^3]: </span>En este post, cuando me refiero a un año, realmente me refiero a una *temporada*. Las temporadas para CONMEBOL y</span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: grafico-resultados</span></span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de resultados LDU en campeonatos internacionales</span></span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Libertadores'</span><span class="ot">=</span> <span class="st">'#C7B143'</span>, <span class="st">'Sudamericana'</span> <span class="ot">=</span> <span class="st">'#20409A'</span>)</span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>international_results_ldu  <span class="sc">%&gt;%</span></span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;</span> <span class="dv">2014</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, stage_reached, <span class="at">fill =</span> tournament)) <span class="sc">+</span></span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.8</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span></span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2014</span>, <span class="dv">2023</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2015.2</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2015.8</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">'Grupos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2017.2</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2018.2</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2018.8</span>, <span class="at">y =</span> <span class="dv">6</span>, <span class="at">label =</span> <span class="st">'Cuartos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2019.8</span>, <span class="at">y =</span> <span class="fl">3.4</span>, <span class="at">label =</span> <span class="st">'Octavos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2020.8</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">'Grupos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2021.2</span>, <span class="at">y =</span> <span class="dv">6</span>, <span class="at">label =</span> <span class="st">'Cuartos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2022.2</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">'Grupos'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>, <span class="at">x =</span> <span class="fl">2023.2</span>, <span class="at">y =</span> <span class="dv">10</span>, <span class="at">label =</span> <span class="st">'Final'</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">'white'</span>, <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">''</span>,</span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">''</span>,</span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'Resultados de copas internacionales para Liga de Quito'</span>,</span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Copa Libertadores y Copa Sudamericana, 2015-2023'</span>,</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">'Campeonato'</span>,</span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">'Nota: Valores sin etiqueta se presentan cuando LDU no participó en el campeonato.'</span>)<span class="sc">+</span></span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a>  theme_daniel<span class="sc">+</span></span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.08</span>, <span class="fl">0.88</span>))</span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a>Naturalmente, a Liga le ha costado mas terminar en etapas avanzadas de Copa Libertadores que de Copa Sudamericana. El salto a la final de la COpa Sudamericana se da de forma abrupta: en 2022 no logra pasar de la etapa de grupos, pero en 2023 arrasa y llega a la final en Montevideo para enfrentarse a Fortaleza de Brasil, un equipo relativamente nuevo en la escena internacional al haber recientemente ascendido a la primera división de Brasil.</span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>Una de las complicaciones de los datos (tanto en FBref como en Transfermarkt) es que el gráfico arriba solamente muestra una escena parcial de la historia de LDU en campeonatos internacionales. Lo más lejos que se puede observar es el resultado de Sudamericana en 2015, en donde Liga cayó ante River Plate tras un recordado <span class="co">[</span><span class="ot">penal errado</span><span class="co">](https://www.youtube.com/watch?v=kXfFJ-mEBjk)</span> por Jonathan Álvez, con Liga como anfitrión. No es posible observar los datos de la mítica liga de los 2000, que ganó la Copa Libertadores y Sudamericana en 2008 y 2009 además de dos Recopas<span class="ot">[^4]</span> en 2009 y 2010. Tampoco es posible observar el periodo posterior a 2010, en donde Liga de Quito no logró clasificar a ningún torneo internacional hasta 2015.</span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a><span class="ot">[^4]: </span>Minitorneo en donde el campeón Libertadores se enfrenta al de Sudamericana. Análogo a la Super Cup en Europa</span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: datos-partidos</span></span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer datos de partidos de Sudamericana para obtener Top Rivales de Liga en Sudamericana</span></span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a>sudamericana_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a>  sudamericana_matches <span class="sc">%&gt;%</span> </span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(year,</span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_home_or_away =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Home'</span>,</span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>              away_team_name<span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Away'</span>),</span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_name,</span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_name),</span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_country =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_country,</span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_country),</span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals,</span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals),</span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals,</span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals),</span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_result =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&gt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Win'</span>,</span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&lt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Loss'</span>,</span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">==</span> opponent_goals <span class="sc">~</span> <span class="st">'Draw'</span>),</span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a>            <span class="at">tournament =</span> <span class="st">'Sudamericana'</span>,</span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Hacer lo mismo para Libertadores</span></span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a>libertadores_matches_ldu <span class="ot">&lt;-</span></span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>  libertadores_matches <span class="sc">%&gt;%</span> </span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">|</span> away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(year,</span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a>            round,</span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a>            date,</span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_home_or_away =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Home'</span>,</span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a>              away_team_name<span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> <span class="st">'Away'</span>),</span>
<span id="cb6-331"><a href="#cb6-331" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-332"><a href="#cb6-332" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_name,</span>
<span id="cb6-333"><a href="#cb6-333" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_name),</span>
<span id="cb6-334"><a href="#cb6-334" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_country =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-335"><a href="#cb6-335" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_team_country,</span>
<span id="cb6-336"><a href="#cb6-336" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_team_country),</span>
<span id="cb6-337"><a href="#cb6-337" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-338"><a href="#cb6-338" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals,</span>
<span id="cb6-339"><a href="#cb6-339" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals),</span>
<span id="cb6-340"><a href="#cb6-340" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_goals =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-341"><a href="#cb6-341" aria-hidden="true" tabindex="-1"></a>              home_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> away_goals,</span>
<span id="cb6-342"><a href="#cb6-342" aria-hidden="true" tabindex="-1"></a>              away_team_name <span class="sc">==</span> <span class="st">'LDU de Quito'</span> <span class="sc">~</span> home_goals),</span>
<span id="cb6-343"><a href="#cb6-343" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_result =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-344"><a href="#cb6-344" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&gt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Win'</span>,</span>
<span id="cb6-345"><a href="#cb6-345" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">&lt;</span> opponent_goals <span class="sc">~</span> <span class="st">'Loss'</span>,</span>
<span id="cb6-346"><a href="#cb6-346" aria-hidden="true" tabindex="-1"></a>              ldu_goals <span class="sc">==</span> opponent_goals <span class="sc">~</span> <span class="st">'Draw'</span>),</span>
<span id="cb6-347"><a href="#cb6-347" aria-hidden="true" tabindex="-1"></a>            <span class="at">tournament =</span> <span class="st">'Libertadores'</span>)</span>
<span id="cb6-348"><a href="#cb6-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-349"><a href="#cb6-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Unir dataframes y obtener totales de goles a favor y en contra para cada año y por cada torneo</span></span>
<span id="cb6-350"><a href="#cb6-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-351"><a href="#cb6-351" aria-hidden="true" tabindex="-1"></a>ldu_match_goals <span class="ot">&lt;-</span></span>
<span id="cb6-352"><a href="#cb6-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(sudamericana_matches_ldu, libertadores_matches_ldu) <span class="sc">%&gt;%</span> </span>
<span id="cb6-353"><a href="#cb6-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, tournament) <span class="sc">%&gt;%</span> </span>
<span id="cb6-354"><a href="#cb6-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ldu_goals =</span> <span class="fu">sum</span>(ldu_goals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-355"><a href="#cb6-355" aria-hidden="true" tabindex="-1"></a>            <span class="at">opponent_goals =</span> <span class="fu">sum</span>(opponent_goals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-356"><a href="#cb6-356" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_wins =</span> <span class="fu">sum</span>(ldu_result <span class="sc">==</span> <span class="st">'Win'</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-357"><a href="#cb6-357" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_losses =</span> <span class="fu">sum</span>(ldu_result <span class="sc">==</span> <span class="st">'Loss'</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-358"><a href="#cb6-358" aria-hidden="true" tabindex="-1"></a>            <span class="at">ldu_draws =</span> <span class="fu">sum</span>(ldu_result <span class="sc">==</span> <span class="st">'Draw'</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-359"><a href="#cb6-359" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_matches =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-360"><a href="#cb6-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ldu_goal_difference =</span> ldu_goals <span class="sc">-</span> opponent_goals,</span>
<span id="cb6-361"><a href="#cb6-361" aria-hidden="true" tabindex="-1"></a>         <span class="at">ldu_win_percentage =</span> ldu_wins <span class="sc">/</span> total_matches <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-362"><a href="#cb6-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, tournament) <span class="sc">%&gt;%</span> </span>
<span id="cb6-363"><a href="#cb6-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb6-364"><a href="#cb6-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-365"><a href="#cb6-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-366"><a href="#cb6-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficar </span></span>
<span id="cb6-367"><a href="#cb6-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a>ldu_match_goals <span class="sc">%&gt;%</span> </span>
<span id="cb6-369"><a href="#cb6-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, tournament, ldu_goals, opponent_goals) <span class="sc">%&gt;%</span></span>
<span id="cb6-370"><a href="#cb6-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(ldu_goals, opponent_goals),</span>
<span id="cb6-371"><a href="#cb6-371" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">'goals_from'</span>,</span>
<span id="cb6-372"><a href="#cb6-372" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">'goals'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-373"><a href="#cb6-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">goals_from =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-374"><a href="#cb6-374" aria-hidden="true" tabindex="-1"></a>    goals_from <span class="sc">==</span> <span class="st">'ldu_goals'</span> <span class="sc">~</span> <span class="st">'A favor'</span>,</span>
<span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a>    goals_from <span class="sc">==</span> <span class="st">'opponent_goals'</span> <span class="sc">~</span> <span class="st">'En contra'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-376"><a href="#cb6-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> goals, <span class="at">fill =</span> goals_from)) <span class="sc">+</span></span>
<span id="cb6-377"><a href="#cb6-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">'dodge'</span>) <span class="sc">+</span></span>
<span id="cb6-378"><a href="#cb6-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2015</span>, <span class="dv">2023</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-379"><a href="#cb6-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'#20409A'</span>, <span class="st">'#EE2E24'</span>)) <span class="sc">+</span></span>
<span id="cb6-380"><a href="#cb6-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>tournament) <span class="sc">+</span></span>
<span id="cb6-381"><a href="#cb6-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Goles a favor y en contra de LDU'</span>,</span>
<span id="cb6-382"><a href="#cb6-382" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Torneos internacionales 2015-2023'</span>,</span>
<span id="cb6-383"><a href="#cb6-383" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">''</span>,</span>
<span id="cb6-384"><a href="#cb6-384" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Goles'</span>,</span>
<span id="cb6-385"><a href="#cb6-385" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">''</span>,</span>
<span id="cb6-386"><a href="#cb6-386" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">str_wrap</span>(<span class="st">'Nota: se presentan goles a favor y en contra solo en casos en donde LDU clasificó y participó en al menos en un partido. Datos de FBref.'</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb6-387"><a href="#cb6-387" aria-hidden="true" tabindex="-1"></a>  theme_daniel <span class="sc">+</span></span>
<span id="cb6-388"><a href="#cb6-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">'white'</span>),</span>
<span id="cb6-389"><a href="#cb6-389" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">linewidth=</span><span class="dv">4</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb6-390"><a href="#cb6-390" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb6-391"><a href="#cb6-391" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'white'</span>),</span>
<span id="cb6-392"><a href="#cb6-392" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.9</span>,<span class="fl">1.18</span>))</span>
<span id="cb6-393"><a href="#cb6-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-394"><a href="#cb6-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-395"><a href="#cb6-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-396"><a href="#cb6-396" aria-hidden="true" tabindex="-1"></a>Los datos preprocesados de *worldfootballR* permiten calcular el número de goles a favor y en contra para cada una de las temporadas de LDU en torneos internacionales. Naturalmente, el equipo ha mejorado su ratio de goles a medida que ha ido pasando a etapas más avanzadas del torneo y como es de esperarse, Liga es más capaz de mantener su arco en cero en la Sudamericana que en la Libertadores. El mejor desempeño de LDU en la Sudamericana se da este año, con 23 goles en 14 partidos, lo que representa un 50% de partidos ganados. Esto, sin embargo, no es el mejor record de LDU en torneos internacionales de los últimos años: en 2020, aunque el equipo solo pasó a octavos de final, logró un 62.5% de partidos ganados en Copa Libertadores. Esto es un claro ejemplo de cómo la estadística simple no debería ser malinterpretada en contextos deportivos como éste.</span>
<span id="cb6-397"><a href="#cb6-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-398"><a href="#cb6-398" aria-hidden="true" tabindex="-1"></a>Sin embargo, hay indicadores que rara vez fallan, y uno de ellos es \$ *la plata* \$. ¿Cuánto invirtió Liga de Quito en los últimos años para llegar donde está el día de hoy? Esta pregunta podría parecer extremadamente complicada de responder, pero los datos de Transfermarkt, plataforma alemana conocida por su exactitud en cuanto a información de traspasos y valor de jugadores, lo facilita. La función que permite obtener esta información permite solamente observar un año a la vez, por lo que utilizo un `for` *loop* (<span class="co">[</span><span class="ot">aunque muy temidos en R, los loops son manejables</span><span class="co">](loops.jpg)</span>) para obtener la información de los últimos años sin tener que llamar la función una y otra vez.</span>
<span id="cb6-399"><a href="#cb6-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-402"><a href="#cb6-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb6-403"><a href="#cb6-403" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ldu-finances</span></span>
<span id="cb6-404"><a href="#cb6-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: true</span></span>
<span id="cb6-405"><a href="#cb6-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb6-406"><a href="#cb6-406" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb6-407"><a href="#cb6-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-408"><a href="#cb6-408" aria-hidden="true" tabindex="-1"></a><span class="co"># El campeonato ecuatoriano está distribuido en dos diferentes links de Transfermarkt, es necesario crear un foroop para cada uno: </span></span>
<span id="cb6-409"><a href="#cb6-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-410"><a href="#cb6-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector de años para el loop (2019-2022)</span></span>
<span id="cb6-411"><a href="#cb6-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-412"><a href="#cb6-412" aria-hidden="true" tabindex="-1"></a>years_1 <span class="ot">&lt;-</span> <span class="dv">2019</span><span class="sc">:</span><span class="dv">2023</span></span>
<span id="cb6-413"><a href="#cb6-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-414"><a href="#cb6-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Inicializar una lista para guardar los resultados de cada iteracion del loop</span></span>
<span id="cb6-415"><a href="#cb6-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-416"><a href="#cb6-416" aria-hidden="true" tabindex="-1"></a>ecuador_finances1 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-417"><a href="#cb6-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-418"><a href="#cb6-418" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> years_1){</span>
<span id="cb6-419"><a href="#cb6-419" aria-hidden="true" tabindex="-1"></a>  ecuador_finances1[[<span class="fu">which</span>(years_1 <span class="sc">==</span> i)]] <span class="ot">&lt;-</span> <span class="fu">tm_team_transfer_balances</span>(<span class="st">'ECU'</span>, </span>
<span id="cb6-420"><a href="#cb6-420" aria-hidden="true" tabindex="-1"></a>                                                                     i, </span>
<span id="cb6-421"><a href="#cb6-421" aria-hidden="true" tabindex="-1"></a>                                                                     <span class="at">league_url =</span> <span class="st">'https://www.transfermarkt.com/ligapro-serie-a-primera-etapa/startseite/wettbewerb/EL1A'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-422"><a href="#cb6-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> i) <span class="co"># Agregar año para cada iteracion</span></span>
<span id="cb6-423"><a href="#cb6-423" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-424"><a href="#cb6-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-425"><a href="#cb6-425" aria-hidden="true" tabindex="-1"></a><span class="co"># El siguiente loop requiere tanto el link como el año, definir los vectores a continuacion</span></span>
<span id="cb6-426"><a href="#cb6-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-427"><a href="#cb6-427" aria-hidden="true" tabindex="-1"></a><span class="co"># Siguiente link: 2012-2018</span></span>
<span id="cb6-428"><a href="#cb6-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-429"><a href="#cb6-429" aria-hidden="true" tabindex="-1"></a>years_2 <span class="ot">&lt;-</span> <span class="dv">2012</span><span class="sc">:</span><span class="dv">2018</span></span>
<span id="cb6-430"><a href="#cb6-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-431"><a href="#cb6-431" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-432"><a href="#cb6-432" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2011'</span>,</span>
<span id="cb6-433"><a href="#cb6-433" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2012'</span>,</span>
<span id="cb6-434"><a href="#cb6-434" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2013'</span>,</span>
<span id="cb6-435"><a href="#cb6-435" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2014'</span>,</span>
<span id="cb6-436"><a href="#cb6-436" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2015'</span>,</span>
<span id="cb6-437"><a href="#cb6-437" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2016'</span>,</span>
<span id="cb6-438"><a href="#cb6-438" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2017'</span>,</span>
<span id="cb6-439"><a href="#cb6-439" aria-hidden="true" tabindex="-1"></a>  <span class="st">'https://www.transfermarkt.com/serie-a-primera-etapa/startseite/wettbewerb/ECPE/plus/?saison_id=2018'</span></span>
<span id="cb6-440"><a href="#cb6-440" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-441"><a href="#cb6-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-442"><a href="#cb6-442" aria-hidden="true" tabindex="-1"></a>ecuador_finances2 <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-443"><a href="#cb6-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-444"><a href="#cb6-444" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(years_2)){</span>
<span id="cb6-445"><a href="#cb6-445" aria-hidden="true" tabindex="-1"></a> ecuador_finances2[[years_2[i]]] <span class="ot">&lt;-</span> <span class="fu">tm_team_transfer_balances</span>(<span class="st">'ECU'</span>, years_2[i], <span class="at">league_url =</span> links[i]) <span class="sc">%&gt;%</span> </span>
<span id="cb6-446"><a href="#cb6-446" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">mutate</span>(<span class="at">year =</span> years_2[i]) </span>
<span id="cb6-447"><a href="#cb6-447" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-448"><a href="#cb6-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-449"><a href="#cb6-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer informacion a un dataframe y limpiar datos:</span></span>
<span id="cb6-450"><a href="#cb6-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-451"><a href="#cb6-451" aria-hidden="true" tabindex="-1"></a>ecuador_finances_full <span class="ot">&lt;-</span></span>
<span id="cb6-452"><a href="#cb6-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(ecuador_finances1, ecuador_finances2) </span>
<span id="cb6-453"><a href="#cb6-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-454"><a href="#cb6-454" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar para solo LDU, calcular ingresos-egresos y graficar en un grafico de barras</span></span>
<span id="cb6-455"><a href="#cb6-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-456"><a href="#cb6-456" aria-hidden="true" tabindex="-1"></a>ecuador_finances_full <span class="sc">%&gt;%</span> </span>
<span id="cb6-457"><a href="#cb6-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(squad <span class="sc">==</span> <span class="st">'LDU Quito'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-458"><a href="#cb6-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(year, </span>
<span id="cb6-459"><a href="#cb6-459" aria-hidden="true" tabindex="-1"></a>            <span class="at">income =</span> income_euros, </span>
<span id="cb6-460"><a href="#cb6-460" aria-hidden="true" tabindex="-1"></a>            <span class="at">expenditure =</span> <span class="sc">-</span>expenditure_euros) <span class="sc">%&gt;%</span> </span>
<span id="cb6-461"><a href="#cb6-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(income, expenditure),</span>
<span id="cb6-462"><a href="#cb6-462" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">'balance_type'</span>,</span>
<span id="cb6-463"><a href="#cb6-463" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">'values'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-464"><a href="#cb6-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">balance_type =</span> <span class="fu">if_else</span>(balance_type <span class="sc">==</span> <span class="st">'income'</span>, <span class="st">'Ingresos'</span>, <span class="st">'Egresos'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-465"><a href="#cb6-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">as.factor</span>(year), values<span class="sc">/</span><span class="dv">1000000</span>, <span class="at">fill =</span> balance_type, <span class="at">group =</span> balance_type)) <span class="sc">+</span> </span>
<span id="cb6-466"><a href="#cb6-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">'dodge'</span>)<span class="sc">+</span></span>
<span id="cb6-467"><a href="#cb6-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">'Ingresos'</span> <span class="ot">=</span> <span class="st">'#20409A'</span>, <span class="st">'Egresos'</span> <span class="ot">=</span> <span class="st">'#EE2E24'</span>)) <span class="sc">+</span></span>
<span id="cb6-468"><a href="#cb6-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb6-469"><a href="#cb6-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">'gray40'</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-470"><a href="#cb6-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Ingresos y egresos para Liga de Quito'</span>,</span>
<span id="cb6-471"><a href="#cb6-471" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">'Cifras de traspasos 2012-2022'</span>,</span>
<span id="cb6-472"><a href="#cb6-472" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">''</span>,</span>
<span id="cb6-473"><a href="#cb6-473" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Miles de euros'</span>,</span>
<span id="cb6-474"><a href="#cb6-474" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">''</span>,</span>
<span id="cb6-475"><a href="#cb6-475" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">str_wrap</span>(<span class="st">'Nota: 2023 es un año parcial. No se presentan datos para las temporadas donde no se registran jugadores vendidos. Datos de Transfemarkt.'</span>, <span class="dv">115</span>)) <span class="sc">+</span></span>
<span id="cb6-476"><a href="#cb6-476" aria-hidden="true" tabindex="-1"></a>  theme_daniel <span class="sc">+</span></span>
<span id="cb6-477"><a href="#cb6-477" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">'white'</span>),</span>
<span id="cb6-478"><a href="#cb6-478" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">linewidth=</span><span class="dv">4</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb6-479"><a href="#cb6-479" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>),</span>
<span id="cb6-480"><a href="#cb6-480" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">'white'</span>),</span>
<span id="cb6-481"><a href="#cb6-481" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.85</span>,<span class="fl">1.1</span>))</span>
<span id="cb6-482"><a href="#cb6-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-483"><a href="#cb6-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-484"><a href="#cb6-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb6-485"><a href="#cb6-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-486"><a href="#cb6-486" aria-hidden="true" tabindex="-1"></a>En 2022 LDU tuvo la mejor temporada en términos de ingresos por traspasos de su historia, logrando vender jugadores por 7.1 millones de euros<span class="ot">[^5]</span>. De forma notable, el club vendió a dos jugadores por altos valores: Rodrigo Aguirre y Nilson Angulo, por 4.75 y 1.90 millones de euros. En 2022 LDU no invirtió dinero en su plantilla, sin embargo, logró traer al equipo a varios agentes libres, situación que no se refleja en el gráfico anterior, pero se puede visualizar en la página web de Transfermarkt. Uno de los jugadores más importantes que llega a LDU como agente libre es Alexander Domínguez, histórico arquero de la selección ecuatoriana y LDU, que regresa al equipo luego de varios años en el exterior. Adicionalmente, las cifras no muestran los valores de contratos temporales, como es el de Renato Ibarra, mediocampista ecuatoriano, quien llega a LDU tras una larga carrera en el fútbol internacional. De todas formas, la inversión en la plantilla de 2021 es la tercera más alta de los últimos 20 años, y los ingresos que LDU ha podido recolectar en 2022 y 2023 potencialmente le permitirán seguir invirtiendo en su plantel existente, así como en la infraestructura del club y las juveniles, que son lo que inicialmente hicieron al club lo que es hoy (y lo que ahora diferencia a Independiente del Valle, también muy exitoso equipo ecuatoriano).</span>
<span id="cb6-487"><a href="#cb6-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-488"><a href="#cb6-488" aria-hidden="true" tabindex="-1"></a><span class="ot">[^5]: </span>Esta es la moneda nativa de Transfermarkt.</span>
<span id="cb6-489"><a href="#cb6-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-490"><a href="#cb6-490" aria-hidden="true" tabindex="-1"></a>Lejos de ser un ejercicio exhaustivo de análisis, lo que este post intenta hacer es dar una mirada aterrizada a las cifras del equipo en los dos torneos más importantes de la región. Es desafortunado que no exista una fuente de datos centralizada que permita analizar el fútbol ecuatoriano y regional más a fondo, sin embargo, las posibilidades que ofrecen los desarrolladores open source de R, como el paquete utilizado aquí, *worldfootballR*, son una muestra de que es posible hacer análisis de datos de fútbol de forma más accesible y transparente. Espero que este trabajo sea de utilidad para quiénes se interesen en extraer y analizar datos de fútbol latinoamericano en gran escala, y, ante todo, que sea un buen augurio para la quinta estrella del trono en Ponceano.</span>
<span id="cb6-491"><a href="#cb6-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-492"><a href="#cb6-492" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Liga te pido ponga🥚...*</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/dsanchezp18">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/daniel_ec18">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/dsanchezp18/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:dsanchezp998@gmail.com">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://rpubs.com/dsanchezp998">RPubs</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Proudly built with Quarto through RStudio.
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>